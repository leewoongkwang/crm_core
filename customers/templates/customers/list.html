{% extends "base.html" %}
{% block title %}ê³ ê° ëª©ë¡{% endblock %}
{% block page_title %}ê³ ê° ëª©ë¡{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-4">
  <h2 class="text-xl font-bold">ğŸ“‹ ê³ ê° ëª©ë¡</h2>
  <a href="{% url 'customers:customer_add' %}" class="bg-blue-600 text-white px-4 py-2 rounded text-sm">+ ì‹ ê·œ ê³ ê° ë“±ë¡</a>
</div>

<section class="bg-white p-4 rounded shadow mb-6">
  <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <input type="text" name="search" value="{{ request.GET.search }}" placeholder="ì´ë¦„ or ì „í™”ë²ˆí˜¸" class="border p-2 rounded">
    <select name="grade" class="border p-2 rounded">
      <option value="">ë“±ê¸‰ ì „ì²´</option>
      <option value="ì¶©ì„±" {% if request.GET.grade == "ì¶©ì„±" %}selected{% endif %}>ì¶©ì„±</option>
      <option value="ê°€ë§" {% if request.GET.grade == "ê°€ë§" %}selected{% endif %}>ê°€ë§</option>
      <option value="ìœ ë ¹" {% if request.GET.grade == "ìœ ë ¹" %}selected{% endif %}>ìœ ë ¹</option>
    </select>
    <select name="attribute" class="border p-2 rounded">
      <option value="">ì†ì„± ì „ì²´</option>
      <option value="ì¸ì½œ" {% if request.GET.attribute == "ì¸ì½œ" %}selected{% endif %}>ì¸ì½œ</option>
      <option value="ì¹´ë“œ" {% if request.GET.attribute == "ì¹´ë“œ" %}selected{% endif %}>ì¹´ë“œ</option>
      <option value="ì§€ì¸" {% if request.GET.attribute == "ì§€ì¸" %}selected{% endif %}>ì§€ì¸</option>
    </select>
    <button type="submit" class="bg-blue-600 text-white rounded px-4 py-2">ê²€ìƒ‰</button>
  </form>
</section>

<section class="bg-white p-4 rounded shadow">
  <table class="w-full text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="py-2 px-3"><a href="?sort=name">ì´ë¦„</a></th>
        <th class="py-2 px-3">ì„±ë³„</th>
        <th class="py-2 px-3">ë³´í—˜ë‚˜ì´</th>
        <th class="py-2 px-3">ìƒë ¹ì¼</th>
        <th class="py-2 px-3"><a href="?sort=grade">ë“±ê¸‰</a></th>
        <th class="py-2 px-3">ì†ì„±</th>
        <th class="py-2 px-3">ì„±í–¥</th>
        <th class="py-2 px-3">ë¼í¬</th>
        <th class="py-2 px-3">íƒ€ê²Ÿ</th>
        <th class="py-2 px-3">í„°ì¹˜</th>
        <th class="py-2 px-3">ë ˆí¬íŠ¸</th>
        <th class="py-2 px-3"><a href="?sort=-created_at">ë“±ë¡ì¼</a></th>
        <th class="py-2 px-3">ë©”ëª¨</th>
        <th class="py-2 px-3">ê´€ë¦¬</th>
      </tr>
    </thead>
    <tbody>
      {% for customer in page_obj %}
      <tr class="border-t hover:bg-gray-50 cursor-pointer" data-id="{{ customer.id }}">
        <td class="py-2 px-3">{{ customer.name }}</td>
        <td class="py-2 px-3">{{ customer.gender }}</td>
        <td class="py-2 px-3">{{ customer.insurance_age }}</td>
        <td class="py-2 px-3">{{ customer.insurance_birthday }}</td>
        <td class="py-2 px-3">{{ customer.grade }}</td>
        <td class="py-2 px-3">{{ customer.attribute }}</td>
        <td class="py-2 px-3">{{ customer.propensity }}</td>
        <td class="py-2 px-3">{{ customer.intimacy }}</td>
        <td class="py-2 px-3">{% if customer.is_target_customer %}âœ…{% else %}âŒ{% endif %}</td>
        <td class="py-2 px-3">{% if customer.is_active_touching %}ğŸŸ¢{% else %}âšª{% endif %}</td>
        <td class="py-2 px-3">{% if customer.has_report %}âœ…{% else %}âŒ{% endif %}</td>
        <td class="py-2 px-3">{{ customer.created_at|date:"Y-m-d" }}</td>
        <td class="py-2 px-3 truncate max-w-xs">{{ customer.memo|truncatechars:20 }}</td>
        <td class="py-2 px-3 space-x-2">
          <a href="{% url 'customers:customer_edit' customer.id %}" class="text-blue-600 text-sm">ìˆ˜ì •</a>
          <a href="{% url 'customers:customer_delete' customer.id %}" class="text-red-600 text-sm">ì‚­ì œ</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="mt-4 flex justify-center space-x-2">
    {% if page_obj.has_previous %}
      <a href="?page=1{% if sort %}&sort={{ sort }}{% endif %}" class="px-3 py-1 border rounded">Â« ì²˜ìŒ</a>
      <a href="?page={{ page_obj.previous_page_number }}{% if sort %}&sort={{ sort }}{% endif %}" class="px-3 py-1 border rounded">â€¹ ì´ì „</a>
    {% endif %}

    <span class="px-4 py-1 text-sm">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if sort %}&sort={{ sort }}{% endif %}" class="px-3 py-1 border rounded">ë‹¤ìŒ â€º</a>
      <a href="?page={{ page_obj.paginator.num_pages }}{% if sort %}&sort={{ sort }}{% endif %}" class="px-3 py-1 border rounded">ë Â»</a>
    {% endif %}
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("tr[data-id]").forEach(row => {
      row.addEventListener("dblclick", () => {
        const id = row.getAttribute("data-id");
        window.location.href = `/customer/${id}/`;
      });
    });
  });
</script>
{% endblock %}