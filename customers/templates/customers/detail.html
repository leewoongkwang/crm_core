{% extends "base.html" %}

{% block title %}ê³ ê° ìƒì„¸ì •ë³´{% endblock %}
{% block page_title %}ê³ ê° ìƒì„¸ì •ë³´{% endblock %}

{% block content %}
<!-- âœ… ê³ ê° í”„ë¡œí•„ ì¹´ë“œ -->
<section class="bg-white p-6 rounded shadow mb-6">
  <h2 class="text-lg font-bold mb-4">ğŸ‘¤ ê³ ê° í”„ë¡œí•„</h2>
  <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
    <div><strong>ì´ë¦„:</strong> {{ customer.name }}</div>
    <div><strong>ì„±ë³„:</strong> {{ customer.get_gender_display }}</div>
    <div><strong>ë³´í—˜ë‚˜ì´:</strong> {{ customer.insurance_age }}</div>
    <div><strong>ê³ ê°ë“±ê¸‰:</strong> {{ customer.grade }}</div>
    <div><strong>ê³ ê°ì†ì„±:</strong> {{ customer.attribute }}</div>
    <div><strong>ìš°ì„ ìˆœìœ„:</strong> {{ customer.priority }}</div>
    <div><strong>ì„±í–¥:</strong> {{ customer.propensity }}</div>
    <div><strong>ë¼í¬í˜•ì„±ë„:</strong> {{ customer.intimacy }}</div>
    <div><strong>ë“±ë¡ì¼:</strong> {{ customer.created_at|date:"Y-m-d" }}</div>

  </div>
</section>

<!-- âœ… ì „ì†¡ ìƒíƒœ ìš”ì•½ ì¹´ë“œ -->
<section class="bg-white p-6 rounded shadow mb-6">
  <h2 class="text-lg font-bold mb-4">ğŸ“¤ ì „ì†¡ ìƒíƒœ</h2>
  <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
    <div>ëª…í•¨ ì „ì†¡: âœ…</div>
    <div>ë¦¬í¬íŠ¸ ì „ì†¡: âœ…</div>
    <div>1ì°¨ì½œ ë¬¸ì: âœ…</div>
    <div>1ì°¨ì½œ ì™„ë£Œ: âŒ</div>
    <div>ê±°ì ˆ í›„ ì œì•ˆì„œ: âœ…</div>
    <div>2ì°¨ì½œ ì™„ë£Œ: âŒ</div>
    <div>ë°©ë¬¸ ì œì•ˆ: âŒ</div>
  </div>
</section>

<!-- âœ… ê³ ê° ë©”ëª¨ -->
<section class="bg-white p-6 rounded shadow mb-6">
  <h2 class="text-lg font-bold mb-2">ğŸ“ ë©”ëª¨</h2>
  <textarea class="w-full border p-2 rounded" rows="4" placeholder="ììœ ë¡­ê²Œ ë©”ëª¨ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”..."></textarea>
  <button class="mt-2 px-4 py-2 bg-blue-600 text-white rounded">ì €ì¥</button>
</section>

<!-- âœ… í•˜ë‹¨ íƒ­ êµ¬ì¡° -->
<section>
  <div class="mb-2 border-b flex space-x-4 text-sm font-semibold">
    <button class="py-2 px-4 hover:text-blue-600" onclick="loadCustomerTab('touchlog', this)">14í„°ì¹˜ ì´ë ¥</button>
    <button class="py-2 px-4 hover:text-blue-600" onclick="loadCustomerTab('reports', this)">ë¦¬í¬íŠ¸ ë‚´ì—­</button>
    <button class="py-2 px-4 hover:text-blue-600" onclick="loadCustomerTab('contracts', this)">ê³„ì•½ì •ë³´</button>
    <button class="py-2 px-4 hover:text-blue-600" onclick="loadCustomerTab('activities', this)">í™œë™ê¸°ë¡</button>
  </div>
  <div id="tab-content" class="bg-white p-6 rounded shadow text-sm text-gray-600">
    <p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
  </div>
</section>

<script>
    function loadCustomerTab(tabName, buttonEl) {
    const customerId = "{{ customer.id }}";
    const container = document.getElementById("tab-content");
    
    // ë²„íŠ¼ ê°•ì¡°
    document.querySelectorAll("section button").forEach(btn => {
      btn.classList.remove("border-b-2", "border-blue-600");
    });
    if (buttonEl) {
      buttonEl.classList.add("border-b-2", "border-blue-600");
    }
  
    // íƒ­ ì´ë¦„ì— ë”°ë¼ API ê²½ë¡œ ë¶„ê¸°
    let url = "";
    if (tabName === "touchlog") {
      url = `/touchlog/customer/${customerId}/partial/`;
    } else if (tabName === "reports") {
      url = `/reports/customer/${customerId}/partial/`;
    } else if (tabName === "contracts") {
      url = `/contracts/customer/${customerId}/partial/`;
    } else if (tabName === "activities") {
      url = `/activities/customer/${customerId}/partial/`;
    } else {
      container.innerHTML = "<p class='text-red-600'>ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íƒ­</p>";
      return;
    }
  
    // AJAX í˜¸ì¶œ
    container.innerHTML = "<p class='text-gray-400'>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";
    fetch(url)
      .then(res => res.text())
      .then(html => container.innerHTML = html)
      .catch(() => container.innerHTML = "<p class='text-red-600'>íƒ­ ë¡œë”© ì‹¤íŒ¨</p>");
  }

  // í˜ì´ì§€ ì§„ì… ì‹œ ê¸°ë³¸ íƒ­ ë¡œë”©
  window.addEventListener("DOMContentLoaded", () => loadCustomerTab("touchlog"));
</script>
{% endblock %}
