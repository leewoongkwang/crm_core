{% extends "base.html" %}
{% load form_tags %}

{% block title %}í•˜ë£¨ ì—…ë¬´ ê¸°ë¡{% endblock %}
{% block page_title %}í•˜ë£¨ ì—…ë¬´ ê¸°ë¡ (KPI + ê³ ê° ì ‘ì´‰){% endblock %}

{% block content %}
<form method="post">
  {% csrf_token %}
  {% if messages %}
    <div class="mb-4">
      {% for message in messages %}
        <p class="text-green-600 text-sm">{{ message }}</p>
      {% endfor %}
    </div>
  {% endif %}

  <!-- ğŸ“Š KPI ì§„í–‰ë¥  ì¹´ë“œ -->
  {% if progress_cards %}
  <section class="bg-white p-6 rounded shadow mb-6">
    <h2 class="text-lg font-bold mb-4">ğŸ“Š KPI ì§„í–‰ë¥ </h2>
    <div class="space-y-4 text-sm">
      {% for card in progress_cards %}
      <div>
        <div class="flex justify-between mb-1">
          <span>{{ card.label }} ({{ card.value }}/{{ card.target }})</span>
          <span>{{ card.percent }}%</span>
        </div>
        <div class="w-full bg-gray-200 rounded h-3">
          <div class="{{ card.css }} h-3 rounded" style="width: {{ card.percent }}%"></div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <!-- ğŸ¯ KPI ì…ë ¥ -->
  <section class="bg-white p-6 rounded shadow mb-6">
    <h2 class="text-lg font-bold mb-4">ğŸ¯ KPI ìˆ˜ì¹˜ ì…ë ¥</h2>
    <div class="space-y-4 text-sm">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="flex flex-col">
          <span>1ë¶„ì½œ</span>
          {{ kpi_form.daily_call_1min|add_class:"w-full border p-2 rounded" }}
          {% if strategy %}<span class="text-xs text-gray-500 mt-1">ëª©í‘œ: {{ strategy.daily_call_1min }}</span>{% endif %}
        </label>
        <label class="flex flex-col">
          <span>2ë¶„ì½œ</span>
          {{ kpi_form.daily_call_2min|add_class:"w-full border p-2 rounded" }}
          {% if strategy %}<span class="text-xs text-gray-500 mt-1">ëª©í‘œ: {{ strategy.daily_call_2min }}</span>{% endif %}
        </label>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="flex flex-col">
          <span>ê³ ê° ì œì•ˆ</span>
          {{ kpi_form.daily_proposals|add_class:"w-full border p-2 rounded" }}
          {% if strategy %}<span class="text-xs text-gray-500 mt-1">ëª©í‘œ: {{ strategy.daily_proposals }}</span>{% endif %}
        </label>
        <label class="flex flex-col">
          <span>ë°©ë¬¸ ì œì•ˆ</span>
          {{ kpi_form.daily_visit_proposals|add_class:"w-full border p-2 rounded" }}
          {% if strategy %}<span class="text-xs text-gray-500 mt-1">ëª©í‘œ: {{ strategy.daily_visit_proposals }}</span>{% endif %}
        </label>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="flex flex-col">
          <span>ê°€ë§ í™•ë³´</span>
          {{ kpi_form.daily_grade_potential|add_class:"w-full border p-2 rounded" }}
          {% if strategy %}<span class="text-xs text-gray-500 mt-1">ëª©í‘œ: {{ strategy.daily_grade_potential }}</span>{% endif %}
        </label>
        <label class="flex flex-col">
          <span>ë°´ë“œ ì¸ì¦</span>
          {{ kpi_form.daily_band_verified|add_class:"w-full border p-2 rounded" }}
          {% if strategy %}<span class="text-xs text-gray-500 mt-1">ëª©í‘œ: {{ strategy.daily_band_verified }}</span>{% endif %}
        </label>
      </div>
    </div>
    <div class="flex justify-end mt-6">
      <button type="submit" name="save_kpi" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">KPI ì €ì¥</button>
    </div>
  </section>

  <!-- ğŸ¤ ê³ ê° ì ‘ì´‰ ì…ë ¥ -->
  <section class="bg-white p-6 rounded shadow mb-6">
    <h2 class="text-lg font-bold mb-4">ğŸ¤ ê³ ê° ì ‘ì´‰ ê¸°ë¡</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
      <label class="flex flex-col">ê³ ê°ëª… {{ touch_form.customer|add_class:"w-full border p-2 rounded" }}</label>
      <label class="flex flex-col">ë°©ì‹ {{ touch_form.method|add_class:"w-full border p-2 rounded" }}</label>
      <label class="flex flex-col col-span-2">ë©”ëª¨ {{ touch_form.memo|add_class:"w-full border p-2 rounded" }}</label>
    </div>
    <div class="flex justify-end mt-4">
      <button type="submit" name="save_touch" class="px-4 py-2 bg-green-600 text-white rounded">ì ‘ì´‰ ê¸°ë¡ ì €ì¥</button>
    </div>
  </section>

  <!-- ğŸ—‚ KPI íˆìŠ¤í† ë¦¬ -->
  {% if kpi_history %}
  <section class="bg-white p-6 rounded shadow mb-6">
    <h2 class="text-lg font-bold mb-4">ğŸ—‚ KPI íˆìŠ¤í† ë¦¬</h2>
    <table class="w-full table-auto text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="py-2 px-4">ë‚ ì§œ</th>
          <th class="py-2 px-4">1ë¶„</th>
          <th class="py-2 px-4">2ë¶„</th>
          <th class="py-2 px-4">ì œì•ˆ</th>
          <th class="py-2 px-4">ë°©ë¬¸</th>
          <th class="py-2 px-4">ê°€ë§</th>
          <th class="py-2 px-4">ë°´ë“œ</th>
        </tr>
      </thead>
      <tbody>
        {% for a in kpi_history %}
        <tr class="border-t">
          <td class="py-2 px-4">{{ a.date }}</td>
          <td class="py-2 px-4">{{ a.daily_call_1min }}</td>
          <td class="py-2 px-4">{{ a.daily_call_2min }}</td>
          <td class="py-2 px-4">{{ a.daily_proposals }}</td>
          <td class="py-2 px-4">{{ a.daily_visit_proposals }}</td>
          <td class="py-2 px-4">{{ a.daily_grade_potential }}</td>
          <td class="py-2 px-4">{{ a.daily_band_verified }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
  {% endif %}

  <!-- ğŸ“‹ ê³ ê° ì ‘ì´‰ íˆìŠ¤í† ë¦¬ -->
  {% if touch_history %}
  <section class="bg-white p-6 rounded shadow">
    <h2 class="text-lg font-bold mb-4">ğŸ“‹ ê³ ê° ì ‘ì´‰ íˆìŠ¤í† ë¦¬</h2>
    <table class="w-full table-auto text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="py-2 px-4">ê³ ê°ëª…</th>
          <th class="py-2 px-4">ë°©ì‹</th>
          <th class="py-2 px-4">ë©”ëª¨</th>
          <th class="py-2 px-4">ë‚ ì§œ</th>
        </tr>
      </thead>
      <tbody>
        {% for t in touch_history %}
        <tr class="border-t">
          <td class="py-2 px-4">{{ t.customer }}</td>
          <td class="py-2 px-4">{{ t.get_method_display }}</td>
          <td class="py-2 px-4">{{ t.memo|truncatechars:20 }}</td>
          <td class="py-2 px-4">{{ t.created_at|date:"Y-m-d H:i" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
  {% endif %}
</form>
{% endblock %}
